{% extends "layout.html" %}
{% block content %}
    <form method=post enctype=multipart/form-data>
      <p><input type=file name=file>
         <input type=submit value=Upload>
    </form>
    <div id="demo-contents"></div>
    <div id="base"></div>

    <script type="text/babel">
        function changeSource(e){
            e.preventDefault();
            var elm = e.target;
            var audio = document.getElementById('music');
            var source = document.getElementById('musicSource');
            source.src = elm.getAttribute('data-value');
            audio.load();
        };
        document.addEventListener("DOMContentLoaded", function() {
            var _handleFileDrop = function(files, event) {
                console.log(files, event);
            };
            var styles = {border: "1px solid black", width: 600, color: "black", padding: 20};
            var myUploader = React.createElement(
                "div", {className: "my-uploader", style: styles},
                    "This is the \".my-uploader\" div. Try dragging a file!",
                    React.createElement(
                        ReactFileDrop, {onDrop: _handleFileDrop, frame: document, dropEffect: "copy"},
                            "Drop some files here!"
                    )
            );
            React.render(myUploader, document.getElementById("demo-contents"))
        });
        class SongFile extends React.Component{
            render(){
                return(
                <button id="songSelector" data-value="{this.props.source}">
                    <p>{this.props.songName}</p>
                </button>
                );
            }
        }
        class Play extends React.Component {
            render() {
                return (
                    <button className="playButton" onClick={aud_play_pause}>
                        <i className="fa fa-play" aria-hidden="true" id="playPause"></i>
                    </button>
                );
            }
        }
        class Skip extends React.Component {
            render(){
                return (
                    <button className="playButton" onClick={skip}>
                        <i className="fa fa-chevron-right" aria-hidden="true" id="playPause"></i>
                    </button>
                );
            }
        }
        class Song extends React.Component {
            render(){
                return (
                    <audio type="audio/wav" autostart="false" volume="1.0" preload="auto" id="music">
                        <source id="musicSource" src='static/music/Estelle_-_American_Boy_Feat_Kanye_West_Video.wav'></source>
                    </audio>
                );
            }
        }
        class WavePlayer extends React.Component {
            renderPlay(){
                return <Play />;
            }
            renderMusic(){
                return
                <div>
                {% for item in list %}
                    <SongFile source="{{item.path}}" songName="{{item.name}}" />
                {% endfor %}
                </div>
            }
            renderSong(){
                return <Song />;
            }
            renderSkip(){
                return <Skip />;
            }
            render() {
                return (
                    <div className="wavePlayer">
                        {this.renderPlay()}
                        {this.renderSkip()}
                        {this.renderSong()}
                        {% for item in list %}
                        <button id="songSelector" onClick={changeSource} data-value="{{item.path}}">
                            <p>{{item.name}}</p>
                        </button>
                        {% endfor %}
                        {this.renderMusic()}
                    </div>
                );
            }
        }
        ReactDOM.render(
            <WavePlayer />,
            document.getElementById('base')
        )
        function skip(){
            var song = document.getElementById("music");
            song.currentTime += 30;
        }
        function aud_play_pause() {
            var mySound = document.getElementById("music");
            if (mySound.paused) {
                 $('#playPause').removeClass('fa fa-play');
                 $('#playPause').addClass('fa fa-pause');
                 mySound.play();

            }
            else {
                $('#playPause').removeClass('fa fa-pause');
                $('#playPause').addClass('fa fa-play');
                mySound.pause();
            }
        }
    </script>
{% endblock %}